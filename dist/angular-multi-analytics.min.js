!function(t){"use strict";t.module("angular-multi-analytics",[]).factory("analyticsDebounce",["$timeout","$q",function(t,e){return function(n,a,r){var c,s=e.defer();return function(){var u=this,i=arguments,o=function(){c=null,r||(s.resolve(n.apply(u,i)),s=e.defer())},g=r&&!c;return c&&t.cancel(c),c=t(o,a),g&&(s.resolve(n.apply(u,i)),s=e.defer()),s.promise}}}]).provider("$analytics",[function(){var e=this;e.trackers={page:[],event:[]},e.cache={pages:[],events:[]},e.settings={debounce:1e3,autoTrackFirstPage:!0,autoTrackVirtualPages:!0,basePath:""},e.consume=function(){function n(e,n){t.forEach(n,function(t){t(e)})}for(;e.cache.pages.length;)n(e.cache.pages.pop(),e.trackers.page);for(;e.cache.events.length;)n(e.cache.events.pop(),e.trackers.event)},e.registerPageTracker=function(t){e.trackers.page.push(t)},e.registerEventTracker=function(t){e.trackers.event.push(t)},e.$get=["analyticsDebounce",function(t){var n=t(e.consume,e.settings.delay);return{trackPage:function(t){e.cache.pages.push(t),n()},trackEvent:function(t){e.cache.events.push(t),n()},settings:e.settings}}]}]).run(["$rootScope","$location","$analytics","$injector",function(t,e,n,a){n.settings.autoTrackFirstPage&&n.trackPage(n.settings.basePath+e.url()),n.settings.autoTrackVirtualPages&&(a.has("$route")&&t.$on("$routeChangeSuccess",function(t,a){a&&(a.$$route||a).redirectTo||n.trackPage(n.settings.basePath+e.url())}),a.has("$state")&&t.$on("$stateChangeSuccess",function(){n.trackPage(n.settings.basePath+e.url())}))}]).directive("analyticsOn",["$analytics",function(e){function n(t){return["a:","button:","button:button","button:submit","input:button","input:submit"].indexOf(t.tagName.toLowerCase()+":"+(t.type||""))>=0}function a(t){return n(t)?t.innerText||t.value:t.id||t.name||t.tagName}function r(t){return"analytics"===t.substr(0,9)&&-1===["On","Event"].indexOf(t.substr(9))}return{restrict:"A",scope:!1,link:function(n,c,s){var u=s.analyticsOn||"click";t.element(c[0]).bind(u,function(){var n={event:s.analyticsEvent||a(c[0])};t.forEach(s.$attr,function(t,e){r(e)&&(n[e.slice(9).toLowerCase()]=s[e])}),e.trackEvent(n)})}}}])}(window.angular);